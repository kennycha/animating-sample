(this["webpackJsonpanimating-sample"]=this["webpackJsonpanimating-sample"]||[]).push([[0],{27:function(e,t,n){},32:function(e,t,n){"use strict";n.r(t);var a,r=n(2),i=n(1),o=n.n(i),c=n(14),s=n.n(c),d=(n(27),n(3)),l=n(5),u=n(6),b=n(10),v=n(0),m=n(21),f=n(15),j=n(16),p=n(17),h=n(4),w=n.n(h),g=["map","aoMap","emissiveMap","glossinessMap","metalnessMap","normalMap","roughnessMap","specularMap"],O=function(e){var t=e.id,n=e.inputUrl,r=e.setLoadedObj,o=(e.mixer,e.setMixer),c=e.setTheTransfromControls,s=Object(i.useState)([]),l=Object(d.a)(s,2),u=l[0],h=l[1],O=Object(i.useState)(void 0),x=Object(d.a)(O,2),C=x[0],k=x[1],S=Object(i.useState)(void 0),y=Object(d.a)(S,2),E=y[0],M=y[1],L=new v.i,z=Object(i.useCallback)((function(){var e=new v.V;return e.background=new v.j(12303291),e.fog=new v.t(12303291,10,80),k(e),e}),[]),A=Object(i.useCallback)((function(e){var t=e.renderingDiv;if(document.removeEventListener("keydown",B),document.removeEventListener("keyup",F),t)for(;t.firstChild;)t.removeChild(t.firstChild);u.forEach((function(e){null===C||void 0===C||C.remove(e),e.traverse((function(e){e.isMesh&&(e.geometry.dispose(),(w.a.isArray(e.material)?e.material:[e.material]).forEach((function(e){g.forEach((function(t){var n;null===(n=e[t])||void 0===n||n.dispose()}))})))}))})),h([]),k(void 0)}),[]),P=Object(i.useCallback)((function(){var e=new v.M(50,window.innerWidth/window.innerHeight,.1,500);return e.position.set(-20,20,2),e.lookAt(0,0,0),e}),[]),T=Object(i.useCallback)((function(e){e.renderingDiv;var t=new v.lb({antialias:!0,alpha:!0});return t.setPixelRatio(window.devicePixelRatio),t.shadowMap.enabled=!0,t.outputEncoding=v.mb,t}),[]),R=Object(i.useCallback)((function(e){var t=e.scene,n=new v.v(11184810);n.position.set(0,20,0),t.add(n);var a=new v.m(16777215,.54);a.position.set(-8,12,8),a.castShadow=!0,a.shadow.mapSize=new v.hb(1e3,1e3),a.shadow.camera.near=.1,a.shadow.camera.far=1500;var r=8.25;a.shadow.camera.left=-1*r,a.shadow.camera.right=r,a.shadow.camera.top=r,a.shadow.camera.bottom=-1*r,t.add(a)}),[]),D=Object(i.useCallback)((function(e){var t=e.scene,n=e.camera,a=e.renderer,r=(new v.eb).load("texture/texture_01.png",(function(){a.render(t,n)}));r.wrapS=v.U,r.wrapT=v.U,r.repeat.set(300,300);var i=new v.E(new v.O(1e3,1e3),new v.H({color:12303291,map:r,depthWrite:!1,side:v.n}));i.position.set(0,0,0),i.rotation.x=-Math.PI/2,i.receiveShadow=!0,t.add(i);var o=new v.x({color:"#EA2027"}),c=new v.x({color:"#0652DD"}),s=[new v.ib(-500,0,0),new v.ib(500,0,0)],d=[new v.ib(0,0,-500),new v.ib(0,0,500)],l=(new v.g).setFromPoints(s),u=(new v.g).setFromPoints(d),b=new v.w(l,o),m=new v.w(u,c);t.add(b,m)}),[]),I=Object(i.useCallback)((function(e){var t=e.camera,n=e.renderer,a=new f.a(t,n.domElement);return a.target.set(0,0,0),a.update(),a.enabled=!0,a.enablePan=!0,a.maxDistance=100,a.minZoom=1.0001,a.addEventListener("change",(function(){if(a.object.position.y<1.01){var e=a.object.position,t=e.x,n=e.y,r=e.z;a.object.position.set(t,n+.01,r)}if(a.object.position.y>100){var i=a.object.position,o=i.x,c=i.y,s=i.z;a.object.position.set(o,c-1,s)}})),h([].concat(Object(b.a)(u),[a])),a}),[]),H=Object(i.useCallback)((function(e){var t=e.scene,n=e.camera,a=e.renderer,r=e.cameraControls,i=new j.a(n,a.domElement);return c(i),i.addEventListener("change",(function(){a.render(t,n)})),i.addEventListener("dragging-changed",(function(e){r.enabled=!e.value})),h([].concat(Object(b.a)(u),[i])),t.add(i),i}),[]),B=function(e){var t=e.event,n=e.transformControls;switch(t.keyCode){case 27:n&&(n.detach(),M(void 0));break;case 81:n&&n.setSpace("local"===n.space?"world":"local");break;case 91:n&&(n.setTranslationSnap(10),n.setRotationSnap(v.B.degToRad(15)));break;case 87:n&&n.setMode("translate");break;case 69:n&&n.setMode("rotate");break;case 82:n&&n.setMode("scale");break;case 187:case 107:n&&n.size<2&&n.setSize(n.size+.1);break;case 189:case 109:n&&n.size>.2&&n.setSize(n.size-.1)}},F=function(e){var t=e.event,n=e.transformControls;switch(t.keyCode){case 91:n&&(n.setTranslationSnap(null),n.setRotationSnap(null))}};Object(i.useEffect)((function(){var e=document.getElementById(t),i=z(),c=P(),s=T({renderingDiv:e});R({scene:i}),D({scene:i,camera:c,renderer:s});var d=I({camera:c,renderer:s}),l=H({scene:i,camera:c,renderer:s,cameraControls:d});n&&(document.addEventListener("keydown",(function(e){return B({event:e,transformControls:l})})),document.addEventListener("keyup",(function(e){return F({event:e,transformControls:l})})),(new m.a).load(n,(function(e){r(e),function(e){var t=e.object;a=new v.c(t),o(a)}({object:e});var t=function(e){var t=e.scene,n=e.object;n.scale.multiplyScalar(.05),n.traverse((function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}));var a=n;return h([].concat(Object(b.a)(u),[a])),t.add(a),a}({scene:i,object:e});!function(e){var t=e.skeletonHelper,n=e.camera,r=e.renderer,i=e.cameraControls,o=e.transformControls;t.bones.forEach((function(e){var t=new v.H({color:16777215,opacity:.5,transparent:!0});t.depthWrite=!1,t.depthTest=!1;var n=new v.Z(2,32,32),a=new v.E(n,t);e.add(a)}));var c=new p.a(t.bones,n,r.domElement);c.addEventListener("hoveron",(function(){i.enabled=!1})),c.addEventListener("hoveroff",(function(){i.enabled=!0})),c.addEventListener("dragstart",(function(e){E!==e.object.parent&&(o.attach(e.object.parent),M(e.object.parent),c.enabled=!1),a.timeScale=0})),c.addEventListener("dragend",(function(e){c.enabled=!0}))}({skeletonHelper:function(e){var t=e.scene,n=e.model,a=new v.X(n);return a.visible=!0,t.add(a),a}({scene:i,model:t}),camera:c,renderer:s,cameraControls:d,transformControls:l})})));e.appendChild(s.domElement);return function e(){if(a&&a.update(L.getDelta()),function(e){var n=e.renderer,a=n.domElement,r=window.innerWidth,i=window.innerHeight,o=a.width/window.devicePixelRatio,c=a.height/window.devicePixelRatio,s=o!==r||c!==i;if(s){var d,l,u=document.getElementById(t);n.setSize(null!==(d=null===u||void 0===u?void 0:u.clientWidth)&&void 0!==d?d:0,null!==(l=null===u||void 0===u?void 0:u.clientHeight)&&void 0!==l?l:0,!1)}return s}({renderer:s})){var n=s.domElement;c.aspect=n.clientWidth/n.clientHeight,c.updateProjectionMatrix()}s.render(i,c),requestAnimationFrame(e)}(),function(){A({renderingDiv:e})}}),[n])},x={translate:"position",rotate:"quaternion",scale:"scale"},C=function(e){var t=e.mixer,n=e.loadedObj,a=e.currentAction,r=e.setCurrentAction,o=e.setPossibleActions,c=e.currentIndex,s=e.theTransformControls,d=Object(i.useCallback)((function(e){var n=e.object.animations,a=n.map((function(e){var a=v.b.findByName(n,e.name);return a=null===t||void 0===t?void 0:t.clipAction(a)}));r(a[0]),o(a)}),[t,n]);Object(i.useEffect)((function(){t&&d({object:n})}),[t]),Object(i.useEffect)((function(){if(a){var e=a.getClip();!function(e){var t=e.transformControls,n=(e.animationMixer,e.targetClip),a=e.targetIndex;t.addEventListener("objectChange",(function(e){var r=e.target.object,i=w.a.find(n.tracks,(function(e){return e.name==="".concat(r.name,".").concat(x[t.mode])}));switch(t.mode){case"translate":var o=e.target.object.position,c=o.x,s=o.y,d=o.z;i.values[3*a]=c,i.values[3*a+1]=s,i.values[3*a+2]=d;break;case"rotate":var l=e.target.object.quaternion,u=l.w,b=l.x,v=l.y,m=l.z;i.values[4*a]=u,i.values[4*a+1]=b,i.values[4*a+2]=v,i.values[4*a+3]=m;break;case"scale":var f=e.target.object.scale,j=f.x,p=f.y,h=f.z;i.values[3*a]=j,i.values[3*a+1]=p,i.values[3*a+2]=h}}))}({transformControls:s,animationMixer:t,targetClip:e,targetIndex:c})}}),[a,c])};function k(){var e=Object(l.a)(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  height: 100%;\n  border-right: 1px solid gray;\n  cursor: pointer;\n"]);return k=function(){return e},e}function S(){var e=Object(l.a)(["\n  width: 100%;\n  height: 40px;\n  display: flex;\n  border-bottom: 1px solid gray;\n"]);return S=function(){return e},e}function y(){var e=Object(l.a)(["\n  min-height: 1024px;\n"]);return y=function(){return e},e}function E(){var e=Object(l.a)([""]);return E=function(){return e},e}function M(){var e=Object(l.a)(["\n  height: 50px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 1.5rem;\n"]);return M=function(){return e},e}var L=u.a.div(M()),z=u.a.input(E()),A=u.a.div(y()),P=u.a.div(S()),T=u.a.div(k()),R=function(){var e=Object(i.useState)(void 0),t=Object(d.a)(e,2),n=t[0],a=t[1],o=Object(i.useState)(void 0),c=Object(d.a)(o,2),s=c[0],l=c[1],u=Object(i.useState)(void 0),b=Object(d.a)(u,2),v=b[0],m=b[1],f=Object(i.useState)(void 0),j=Object(d.a)(f,2),p=j[0],h=j[1],g=Object(i.useState)([]),x=Object(d.a)(g,2),k=x[0],S=x[1],y=Object(i.useState)(0),E=Object(d.a)(y,2),M=E[0],R=E[1],D=Object(i.useState)(void 0),I=Object(d.a)(D,2),H=I[0],B=I[1];return O({id:"renderingDiv",inputUrl:n,setLoadedObj:l,mixer:v,setMixer:m,setTheTransfromControls:B}),C({mixer:v,loadedObj:s,currentAction:p,setCurrentAction:h,setPossibleActions:S,currentIndex:M,theTransformControls:H}),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(L,{children:"Animating Sample"}),Object(r.jsx)(z,{type:"file",accept:".fbx",onChange:function(e){var t=e.target.files[0];if(Boolean(t)){var n=URL.createObjectURL(t);a(n)}}}),Object(r.jsx)(A,{id:"renderingDiv"}),p&&Object(r.jsxs)(P,{children:[Object(r.jsx)(T,{onClick:function(){v.setTime(0),p.reset()},children:"Reset"}),Object(r.jsx)(T,{onClick:function(){v.timeScale=-.3,p.play()},children:"Backward"}),Object(r.jsx)(T,{onClick:function(){v.timeScale=.3,p.play()},children:"Forward"}),Object(r.jsx)(T,{onClick:function(){v.timeScale=0},children:"Pause"}),Object(r.jsx)(T,{onClick:function(){p.stop()},children:"Stop"})]}),p&&Object(r.jsx)(z,{onKeyPress:function(e){if("Enter"===e.key){var t=parseInt(e.target.value%p._clip.tracks[0].times.length);if(w.a.isFinite(t)){R(t),p.isRunning()||p.play(),v.timeScale=.3;var n=parseFloat(p._clip.tracks[0].times[t]/v.timeScale);v.setTime(n),v.timeScale=0}}}}),0!==k.length&&Object(r.jsx)(P,{children:k&&k.map((function(e,t){return Object(r.jsx)(T,{onClick:function(){return function(e){var t=e.action;p.stop(),h(t)}({action:e})},children:"Anim #".concat(t+1)},t)}))})]})};s.a.render(Object(r.jsx)(o.a.StrictMode,{children:Object(r.jsx)(R,{})}),document.getElementById("root"))}},[[32,1,2]]]);
//# sourceMappingURL=main.50e5da6d.chunk.js.map